# 文件系统

## 文件概念

文件是记录在外存上的相关信息的具有名称的集合

### 文件操作

- 创建
- 写
- 读
- 在文件内冲定位，即文件寻址(seek)
- 删除
- 截断文件：删除文件内容而不删除文件，shell 重定向 `>` 或 `truncate`

### 打开文件表

- 为避免不断的文件搜索操作，操作系统维护一个包含所有打开文件的信息表(open-file table)
- 当需要一个文件操作时，可通过该表的索引指定文件
- 当文件不再使用，进程可关闭它
- 有的系统在首次引用文件时，会隐式地打开它

每个打开文件有如下相关信息

- 文件指针
- 文件打开计数器：记录多少进程打开了该文件
- 文件磁盘位置
- 访问权限

### 文件锁
- shared lock
- exclusive lock

操作系统提供强制(mandatory, e.g. Windows)或建议(advisory, e.g. Linux)文件加锁机制

Unix 采用 magic number 来大致表明文件类型

## 访问方法

文件访问：在使用时将文件存储的信息读入到内存。访问方式成为了一个重要的设计问题

### 顺序访问

基于文件的磁带模型，按记录的顺序进行处理

### 直接访问

- 文件由固定长度的逻辑记录组成，以允许程序按任意顺序进行快速读和写，基于文件的磁盘模型
- 需要对文件操作进行修改从而能将块号作为参数

### 其他访问方式

索引

## 目录结构

### 存储结构

- 磁盘上装多种文件系统，或一部分用于交换空间或非格式化的磁盘空间，这些部分称为分区或片
- 每个磁盘分区可以创建一个文件系统，这些部分可以组合成更大的卷(volume)

包含文件系统的每个卷必须包含系统上的文件爱你信息，这些信息保存在设备目录或卷表中

### 目录

目录可以看作符号表，能将文件爱你名称转换成目录条目

目录的操作：

- 搜索文件
- 创建文件
- 遍历文件
- 重命名文件
- 跟踪文件系统(备份)

目录结构

- 单层结构目录
- 双层结构目录
- 树状目录
- 无环图目录
- 通用图目录

#### 无环图目录

允许目录含有共享子目录和文件，统一文件或子目录可以出现在两个不同目录中

linux 中的链接`ln`

## 文件系统安装(mount)

文件系统在被系统上的进程使用之前必须 mount

mount步骤：

- 操作系统需要指导设备名称和文件系统的安装位置(称为安装点)
- 操作系统验证设备是否包含一个有效的文件系统

## 文件共享

- 多用户
- 远程文件系统
  - 客户端-服务端
  - 分布式文件系统
